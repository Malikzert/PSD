
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>DEPLOYMENT SYSTEM TIMESERIES &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'deploy_timeseries';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Time Series Dataset untuk Prediksi" href="timeseries.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/mlk.jpg" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/mlk.jpg" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Selamat datang, Mata kuliah Proyek Sains Data
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="tugas1.html">Tugas 1 Eksplorasi menggunakan Power BI</a></li>




<li class="toctree-l1 has-children"><a class="reference internal" href="tugas2.html">TUGAS 2 TRANSFORMASI DATA</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="Anomaly_Detection.html">Preprocessing Penghapusan outlier</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="tugas3.html">Penyeimbangan dataset (SMOTE, ADASYN)</a></li>






<li class="toctree-l1 current active has-children"><a class="reference internal" href="timeseries.html">Time Series Dataset untuk Prediksi</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">DEPLOYMENT SYSTEM TIMESERIES</a></li>







</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fdeploy_timeseries.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/deploy_timeseries.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>DEPLOYMENT SYSTEM TIMESERIES</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">DEPLOYMENT SYSTEM TIMESERIES</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#mengambil-dan-membaca-data-no2-sumenep">Mengambil dan membaca data NO2 sumenep</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#membuat-prediksi-model-knn-regressor">Membuat prediksi model knn regressor</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pemrosesan-dan-pembentukan-data">Pemrosesan dan Pembentukan Data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fungsi-forecasting-pada-time-series">Fungsi Forecasting pada Time Series</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluasi-model-metrics-utils">Evaluasi Model (Metrics Utils)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualisasi-hasil-prediksi-plot-utils">Visualisasi Hasil Prediksi (Plot Utils)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#aplikasi-streamlit-untuk-prediksi-no2-sumenep-menggunakan-knn-time-series">Aplikasi Streamlit untuk Prediksi NO₂ Sumenep Menggunakan KNN Time Series</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="deployment-system-timeseries">
<h1>DEPLOYMENT SYSTEM TIMESERIES<a class="headerlink" href="#deployment-system-timeseries" title="Link to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="mengambil-dan-membaca-data-no2-sumenep">
<h1>Mengambil dan membaca data NO2 sumenep<a class="headerlink" href="#mengambil-dan-membaca-data-no2-sumenep" title="Link to this heading">#</a></h1>
<p>Kode di bawah digunakan untuk membaca file CSV berisi data kadar NO₂ menggunakan pustaka pandas di Python. Pertama, path file didefinisikan dalam variabel DATA_PATH, kemudian fungsi pd.read_csv() digunakan untuk memuat data ke dalam sebuah DataFrame bernama df. Program menampilkan lima baris pertama dataset menggunakan df.head(), informasi struktur data (seperti jumlah kolom, tipe data, dan nilai non-null) dengan <a class="reference external" href="http://df.info">df.info</a>(), serta ringkasan statistik deskriptif seperti rata-rata, standar deviasi, dan nilai maksimum menggunakan df.describe(). Blok try-except digunakan untuk menangani kemungkinan kesalahan seperti file tidak ditemukan atau format CSV yang tidak sesuai, sehingga program tidak langsung berhenti saat terjadi error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="c1"># Path ke file CSV</span>
<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="s2">&quot;/content/NO2_Sumenep.csv&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Membaca data CSV</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">)</span>

    <span class="c1"># Tampilkan beberapa baris awal</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;📊 Data Awal NO₂ Sumenep:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

    <span class="c1"># Tampilkan informasi umum dataset</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🧭 Info Dataset:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>

    <span class="c1"># Tampilkan statistik dasar</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📈 Deskripsi Statistik:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; File tidak ditemukan di path: </span><span class="si">{</span><span class="n">DATA_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; Terjadi kesalahan saat membaca CSV: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> File tidak ditemukan di path: /content/NO2_Sumenep.csv
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="membuat-prediksi-model-knn-regressor">
<h1>Membuat prediksi model knn regressor<a class="headerlink" href="#membuat-prediksi-model-knn-regressor" title="Link to this heading">#</a></h1>
<p>Kode di bawah menggunakan algoritma K-Nearest Neighbors (KNN) untuk melakukan prediksi deret waktu (time series) kadar NO₂. Fungsi train_knn_model() bertugas melatih model KNN berdasarkan data latih (X_train dan y_train) dengan parameter n_neighbors yang menentukan jumlah tetangga terdekat yang digunakan dalam prediksi. Model menggunakan pembobotan weights=’distance’, yang berarti tetangga yang lebih dekat memiliki pengaruh lebih besar dalam menentukan hasil prediksi. Setelah pelatihan, model siap digunakan untuk memprediksi nilai di luar data latih (future forecasting).</p>
<p>Fungsi forecast_next_days() digunakan untuk memprediksi nilai NO₂ beberapa hari ke depan (n_future). Proses dimulai dengan mengambil data input terakhir dari X_test, kemudian secara iteratif memprediksi nilai berikutnya dan memperbarui input untuk prediksi selanjutnya dengan cara menggeser (np.roll) dan menambahkan nilai prediksi terbaru di posisi terakhir. Hasil prediksi disimpan dalam future_preds, lalu dibuat DataFrame forecast_df yang berisi tanggal-tanggal masa depan (future_dates) serta nilai prediksi NO₂ yang sesuai. Dengan demikian, fungsi ini menghasilkan output yang siap digunakan untuk analisis atau visualisasi tren polutan di masa depan.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn</span><span class="w"> </span><span class="kn">import</span> <span class="n">neighbors</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">train_knn_model</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;distance&#39;</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>

<span class="k">def</span><span class="w"> </span><span class="nf">forecast_next_days</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">n_future</span><span class="p">):</span>
    <span class="n">last_input</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">future_preds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_future</span><span class="p">):</span>
        <span class="n">next_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">last_input</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">future_preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_pred</span><span class="p">)</span>
        <span class="n">last_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">last_input</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">last_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">next_pred</span>

    <span class="n">future_dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">periods</span><span class="o">=</span><span class="n">n_future</span><span class="p">)</span>
    <span class="n">forecast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Tanggal&quot;</span><span class="p">:</span> <span class="n">future_dates</span><span class="p">,</span> <span class="s2">&quot;Prediksi_NO2&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">future_preds</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">forecast_df</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="pemrosesan-dan-pembentukan-data">
<h1>Pemrosesan dan Pembentukan Data<a class="headerlink" href="#pemrosesan-dan-pembentukan-data" title="Link to this heading">#</a></h1>
<p>Kode di bawah berfungsi untuk mempersiapkan data deret waktu (time series) kadar NO₂ agar siap digunakan dalam pemodelan. Fungsi load_and_prepare_data() bertugas membaca file CSV yang berisi data pengukuran NO₂ dengan kolom waktu (time) dan nilai kadar NO₂ (NO2). Kolom waktu dikonversi menjadi tipe datetime agar bisa digunakan sebagai indeks deret waktu, kemudian dilakukan interpolasi dengan metode waktu (interpolate(method=’time’)) untuk mengisi nilai yang hilang berdasarkan tren waktu. Langkah ini memastikan bahwa data memiliki urutan kronologis yang konsisten dan bebas dari nilai kosong yang bisa mengganggu pelatihan model.</p>
<p>Fungsi create_supervised_data() digunakan untuk mengubah data deret waktu menjadi bentuk supervised learning, yaitu dengan membuat sejumlah fitur lag (NO2(t-1), NO2(t-2), dan seterusnya) sebagai input untuk memprediksi nilai NO2(t) di hari berikutnya. Data kemudian dibagi menjadi data latih (70%) dan data uji (30%) untuk evaluasi model. Sebelum digunakan dalam algoritma KNN, seluruh fitur diubah ke dalam rentang [0, 1] menggunakan MinMaxScaler, agar setiap variabel memiliki skala yang seimbang dan model dapat belajar lebih efektif. Hasil akhirnya adalah data latih dan uji yang telah ditransformasi, siap untuk digunakan dalam proses pelatihan model prediksi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="k">def</span><span class="w"> </span><span class="nf">load_and_prepare_data</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_supervised_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_lags</span><span class="p">):</span>
    <span class="n">supervised</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_lags</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">supervised</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;NO2(t-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">supervised</span><span class="p">[</span><span class="s1">&#39;NO2(t)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">]</span>
    <span class="n">supervised</span> <span class="o">=</span> <span class="n">supervised</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">supervised</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;NO2(t)&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">supervised</span><span class="p">[</span><span class="s1">&#39;NO2(t)&#39;</span><span class="p">]</span>

    <span class="n">split_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_idx</span><span class="p">],</span> <span class="n">X</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_idx</span><span class="p">:]</span>
    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">split_idx</span><span class="p">],</span> <span class="n">y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">split_idx</span><span class="p">:]</span>

    <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
    <span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">X_test_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">scaler</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="fungsi-forecasting-pada-time-series">
<h1>Fungsi Forecasting pada Time Series<a class="headerlink" href="#fungsi-forecasting-pada-time-series" title="Link to this heading">#</a></h1>
<p>Kode di bawah berfungsi untuk menghasilkan prediksi kadar NO₂ untuk beberapa hari ke depan menggunakan model time series berbasis KNN. Fungsi forecast_next_days() memulai proses dengan mengambil data input terakhir (last_input) dari data uji (X_test) sebagai kondisi awal prediksi. Model kemudian digunakan secara iteratif untuk memprediksi satu nilai di masa depan, menambahkannya ke daftar hasil (preds), dan memperbarui jendela input menggunakan pendekatan sliding window — di mana nilai prediksi terbaru menggantikan nilai lag tertua. Proses ini diulang sebanyak jumlah hari yang ingin diprediksi (n_future), sehingga diperoleh serangkaian nilai prediksi jangka pendek ke depan.</p>
<p>Setelah semua prediksi diperoleh, hasilnya perlu dikembalikan ke skala asli karena sebelumnya data telah dinormalisasi. Oleh karena itu, dilakukan inverse transform menggunakan nilai minimum dan maksimum dari objek MinMaxScaler. Nilai-nilai prediksi kemudian disusun menjadi sebuah DataFrame berisi kolom tanggal (Tanggal) dan hasil prediksi (Prediksi_NO2). Tanggal-tanggal tersebut dihasilkan secara otomatis berdasarkan tanggal terakhir pada dataset historis dengan frekuensi harian. Hasil akhirnya berupa tabel berisi tanggal-tanggal masa depan beserta kadar NO₂ yang diprediksi, yang dapat digunakan untuk visualisasi tren atau analisis lanjutan.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># utils/forecast_utils.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="k">def</span><span class="w"> </span><span class="nf">forecast_next_days</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">n_future</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Membuat prediksi untuk n hari ke depan menggunakan model time series.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">last_input</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_future</span><span class="p">):</span>
        <span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">last_input</span><span class="p">)</span>
        <span class="n">pred_value</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">pred</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">pred</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred_value</span><span class="p">)</span>

        <span class="c1"># sliding window</span>
        <span class="n">new_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">last_input</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">pred_value</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">last_input</span> <span class="o">=</span> <span class="n">new_input</span>

    <span class="c1"># --- inverse transform hanya kolom target (NO2) ---</span>
    <span class="n">min_val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">data_min_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># ambil min dari kolom target</span>
    <span class="n">max_val</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">data_max_</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># ambil max dari kolom target</span>

    <span class="n">preds_rescaled</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">max_val</span> <span class="o">-</span> <span class="n">min_val</span><span class="p">)</span> <span class="o">+</span> <span class="n">min_val</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">preds</span><span class="p">]</span>

    <span class="c1"># buat DataFrame hasil forecast (kolom disesuaikan dengan plot_utils)</span>
    <span class="n">last_date</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">forecast_dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">last_date</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">n_future</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">forecast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="s1">&#39;Tanggal&#39;</span><span class="p">:</span> <span class="n">forecast_dates</span><span class="p">,</span>
        <span class="s1">&#39;Prediksi_NO2&#39;</span><span class="p">:</span> <span class="n">preds_rescaled</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">forecast_df</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="evaluasi-model-metrics-utils">
<h1>Evaluasi Model (Metrics Utils)<a class="headerlink" href="#evaluasi-model-metrics-utils" title="Link to this heading">#</a></h1>
<p>Kode di bawah berfungsi untuk mengevaluasi kinerja model regresi time series, khususnya model KNN, dengan menghitung berbagai metrik statistik. Fungsi evaluate_model() menerima tiga parameter utama: model yang telah dilatih (model), data uji (X_test), dan nilai aktual (y_test). Fungsi ini kemudian menghasilkan prediksi (y_pred) dengan memanggil metode .predict() dari model. Setelah prediksi diperoleh, tiga metrik utama digunakan untuk mengukur performa model, yaitu Root Mean Squared Error (RMSE), R-squared (R²), dan Mean Absolute Percentage Error (MAPE).</p>
<p>RMSE digunakan untuk mengukur seberapa besar kesalahan rata-rata dalam satuan yang sama dengan data aslinya, di mana nilai yang lebih kecil menunjukkan hasil prediksi yang lebih akurat. R² mengukur seberapa baik model mampu menjelaskan variabilitas data aktual — nilai mendekati 1 berarti model sangat baik dalam menjelaskan data. Sementara itu, MAPE menampilkan kesalahan rata-rata dalam bentuk persentase, memudahkan interpretasi terhadap seberapa besar deviasi prediksi terhadap nilai aktual. Hasil akhir fungsi ini mengembalikan keempat nilai tersebut (y_pred, rmse, r2, mape) yang kemudian dapat digunakan untuk pelaporan, perbandingan model, atau analisis performa prediksi.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_absolute_percentage_error</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="k">def</span><span class="w"> </span><span class="nf">evaluate_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">):</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">mape</span> <span class="o">=</span> <span class="n">mean_absolute_percentage_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">return</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">mape</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualisasi-hasil-prediksi-plot-utils">
<h1>Visualisasi Hasil Prediksi (Plot Utils)<a class="headerlink" href="#visualisasi-hasil-prediksi-plot-utils" title="Link to this heading">#</a></h1>
<p>Kode di bawah berisi tiga fungsi utama untuk visualisasi hasil prediksi model KNN pada data time series NO₂. Fungsi plot_actual_vs_pred() digunakan untuk membandingkan antara nilai aktual (y_test) dan hasil prediksi (y_pred) dari model. Grafik ini menampilkan dua garis dengan warna berbeda untuk menunjukkan seberapa baik model mengikuti pola data asli. Parameter k menunjukkan jumlah tetangga (neighbors) pada algoritma KNN, yang ditampilkan dalam judul grafik agar hasil dapat lebih mudah dianalisis dan dibandingkan.</p>
<p>Selanjutnya, fungsi plot_forecast() menampilkan grafik prediksi ke depan (forecasting) berdasarkan data historis dan hasil peramalan beberapa hari berikutnya. Data historis divisualisasikan sebagai garis abu-abu, sedangkan hasil prediksi ditunjukkan dengan garis merah berbentuk titik-titik untuk membedakan masa depan dari data sebelumnya. Fungsi terakhir, plot_residual_acf(), digunakan untuk menganalisis autokorelasi residual, yaitu selisih antara nilai aktual dan prediksi. Dengan menggunakan fungsi plot_acf() dari statsmodels, grafik ini membantu mengevaluasi apakah masih ada pola dalam residual — jika tidak, berarti model sudah cukup baik dalam menangkap pola data. Ketiga fungsi ini sangat penting untuk memvalidasi dan mempresentasikan performa model secara visual.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.graphics.tsaplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_acf</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_actual_vs_pred</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Aktual&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Prediksi&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;KNN Forecasting NO₂ (K=</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Tanggal&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Kadar NO₂&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_forecast</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">forecast_df</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data Historis&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast_df</span><span class="p">[</span><span class="s1">&#39;Tanggal&#39;</span><span class="p">],</span> <span class="n">forecast_df</span><span class="p">[</span><span class="s1">&#39;Prediksi_NO2&#39;</span><span class="p">],</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Prediksi NO₂&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Prediksi NO₂ Beberapa Hari ke Depan&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_residual_acf</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">plot_acf</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Autokorelasi Residual&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.graphics.tsaplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_acf</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="k">def</span><span class="w"> </span><span class="nf">plot_actual_vs_pred</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;statsmodels&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="aplikasi-streamlit-untuk-prediksi-no2-sumenep-menggunakan-knn-time-series">
<h1>Aplikasi Streamlit untuk Prediksi NO₂ Sumenep Menggunakan KNN Time Series<a class="headerlink" href="#aplikasi-streamlit-untuk-prediksi-no2-sumenep-menggunakan-knn-time-series" title="Link to this heading">#</a></h1>
<p>Kode di bawah merupakan aplikasi Streamlit interaktif yang digunakan untuk memprediksi kadar gas NO₂ (Nitrogen Dioksida) di wilayah Sumenep menggunakan metode K-Nearest Neighbors (KNN) berbasis time series forecasting. Aplikasi ini membaca data dari file NO2_Sumenep.csv, memprosesnya menjadi format terstruktur menggunakan fungsi load_and_prepare_data(), dan menampilkan grafik historis kadar NO₂. Pengguna dapat mengatur parameter model secara dinamis melalui sidebar, seperti jumlah lag (hari sebelumnya yang digunakan sebagai input), jumlah tetangga (neighbors), dan jumlah hari ke depan yang ingin diprediksi.</p>
<p>Setelah data dipersiapkan dan model KNN dilatih, aplikasi menampilkan hasil evaluasi performa model melalui metrik seperti RMSE (Root Mean Square Error), R² (Koefisien Determinasi), dan MAPE (Mean Absolute Percentage Error). Hasil prediksi divisualisasikan dalam grafik yang membandingkan data aktual dengan hasil prediksi serta proyeksi kadar NO₂ untuk beberapa hari ke depan. Selain itu, disediakan juga analisis autokorelasi residual untuk menilai kualitas model. Pengguna dapat mengunduh hasil prediksi dalam format CSV langsung dari antarmuka. Dengan desain modular dan antarmuka interaktif, aplikasi ini sangat membantu dalam eksplorasi, analisis, serta pemantauan kualitas udara secara prediktif.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span><span class="o">,</span><span class="w"> </span><span class="nn">os</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">streamlit</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">st</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">statsmodels.graphics.tsaplots</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_acf</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">utils.data_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_and_prepare_data</span><span class="p">,</span> <span class="n">create_supervised_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.plot_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_actual_vs_pred</span><span class="p">,</span> <span class="n">plot_forecast</span><span class="p">,</span> <span class="n">plot_residual_acf</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.metrics_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">evaluate_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">utils.forecast_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">forecast_next_days</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">models.knn_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">train_knn_model</span>


<span class="c1"># --- Konfigurasi Tampilan ---</span>
<span class="n">st</span><span class="o">.</span><span class="n">set_page_config</span><span class="p">(</span><span class="n">page_title</span><span class="o">=</span><span class="s2">&quot;Prediksi NO₂ Sumenep&quot;</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;wide&quot;</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;🌫️ Prediksi Kadar NO₂ Sumenep Menggunakan KNN Time Series&quot;</span><span class="p">)</span>

<span class="c1"># --- Baca dataset lokal ---</span>
<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;data\NO2_Sumenep.csv&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">load_and_prepare_data</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">st</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gagal membaca dataset: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

<span class="c1"># --- Tampilkan data awal ---</span>
<span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;📈 Data Historis NO₂&quot;</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">line_chart</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;NO2&#39;</span><span class="p">])</span>

<span class="c1"># --- Sidebar pengaturan model ---</span>
<span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;⚙️ Pengaturan Model&quot;</span><span class="p">)</span>
<span class="n">n_lags</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Jumlah Lag Hari Sebelumnya&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">n_neighbors</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Jumlah Tetangga (K)&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">n_future</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">sidebar</span><span class="o">.</span><span class="n">slider</span><span class="p">(</span><span class="s2">&quot;Hari Prediksi ke Depan&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>

<span class="c1"># --- Persiapan data supervised ---</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">scaler</span> <span class="o">=</span> <span class="n">create_supervised_data</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_lags</span><span class="p">)</span>

<span class="c1"># --- Training model KNN ---</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">train_knn_model</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="p">)</span>

<span class="c1"># --- Evaluasi model ---</span>
<span class="n">y_pred</span><span class="p">,</span> <span class="n">rmse</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">mape</span> <span class="o">=</span> <span class="n">evaluate_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>

<span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;📊 Evaluasi Model&quot;</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**RMSE:** </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**R²:** </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**MAPE:** </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="n">st</span><span class="o">.</span><span class="n">pyplot</span><span class="p">(</span><span class="n">plot_actual_vs_pred</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">n_neighbors</span><span class="p">))</span>

<span class="c1"># --- Prediksi ke depan ---</span>
<span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;🔮 Prediksi </span><span class="si">{</span><span class="n">n_future</span><span class="si">}</span><span class="s2"> Hari ke Depan&quot;</span><span class="p">)</span>
<span class="n">forecast_df</span> <span class="o">=</span> <span class="n">forecast_next_days</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">scaler</span><span class="p">,</span> <span class="n">n_future</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">dataframe</span><span class="p">(</span><span class="n">forecast_df</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">pyplot</span><span class="p">(</span><span class="n">plot_forecast</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">forecast_df</span><span class="p">))</span>

<span class="c1"># --- Analisis residual ---</span>
<span class="n">st</span><span class="o">.</span><span class="n">subheader</span><span class="p">(</span><span class="s2">&quot;🔍 Analisis Autokorelasi Residual&quot;</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">pyplot</span><span class="p">(</span><span class="n">plot_residual_acf</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

<span class="c1"># --- Tombol unduh hasil ---</span>
<span class="n">csv</span> <span class="o">=</span> <span class="n">forecast_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">st</span><span class="o">.</span><span class="n">download_button</span><span class="p">(</span><span class="s2">&quot;⬇️ Unduh Hasil Prediksi (CSV)&quot;</span><span class="p">,</span> <span class="n">csv</span><span class="p">,</span> <span class="s2">&quot;forecast_no2.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;text/csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>link deployment streamlit :</p>
<p><a class="reference external" href="https://timeseriesdeployabdulmalik23136.streamlit.app/">https://timeseriesdeployabdulmalik23136.streamlit.app/</a></p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="timeseries.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Time Series Dataset untuk Prediksi</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">DEPLOYMENT SYSTEM TIMESERIES</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#mengambil-dan-membaca-data-no2-sumenep">Mengambil dan membaca data NO2 sumenep</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#membuat-prediksi-model-knn-regressor">Membuat prediksi model knn regressor</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pemrosesan-dan-pembentukan-data">Pemrosesan dan Pembentukan Data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fungsi-forecasting-pada-time-series">Fungsi Forecasting pada Time Series</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluasi-model-metrics-utils">Evaluasi Model (Metrics Utils)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualisasi-hasil-prediksi-plot-utils">Visualisasi Hasil Prediksi (Plot Utils)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#aplikasi-streamlit-untuk-prediksi-no2-sumenep-menggunakan-knn-time-series">Aplikasi Streamlit untuk Prediksi NO₂ Sumenep Menggunakan KNN Time Series</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>